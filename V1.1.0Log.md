# PulseBench V1.1.0 - Beta

## Table of Contents
- Summary
- What's new (detailed)
- How to run (GUI)
- How to run (CLI)
- Packaging into a single GUI binary (PyInstaller)
- Files added / modified
- Known issues & environment notes
- Developer notes & next steps
- LICENSE

---

## Summary

PulseBench V1.1.0 - Beta introduces a native GUI wrapper for the existing CLI benchmark binary, live system metrics charts, CSV export of logged metrics, and a simple launcher script. The GUI is implemented in Python (PySide6 + pyqtgraph + psutil) and can either be run from the project venv or bundled into a single executable using PyInstaller.

This release keeps the CLI and GUI as separate artifacts:

- CLI binary (C++): `build/pulsebench`
- GUI (Python, can be packaged to a single binary): `gui/main.py` (or packaged `dist/pulsebench-gui`)

---

## What’s new (detailed)

- New GUI application
  - Implemented a desktop GUI in `gui/main.py` using PySide6 and pyqtgraph.
  - The GUI provides:
    - Start / Stop controls to launch/terminate the CLI binary.
    - Live plots for CPU usage (%), CPU frequency (MHz), memory usage (%), and CPU temperature (°C).
    - A Process Output pane to show (future) runtime output from the CLI (console log area).
    - A Binary chooser (text + Browse button) so the user can point the GUI at any `pulsebench` binary on disk.

- Improved CPU temperature handling
  - The GUI now reads all reported sensors (via `psutil.sensors_temperatures()`), and selects the maximum temperature reading across sensors as a better indicator of the hottest core. This fixes incorrect low constant values observed earlier.

- CSV logging & export on process end
  - While the GUI is running it records full metric rows to an in-memory buffer (timestamp, cpu_percent, memory_percent, cpu_freq, cpu_temp).
  - When the CLI process ends (either naturally or via Stop), the GUI prompts the user to export the logged metrics to a CSV file and writes a CSV with the recorded fields.

- Process watcher
  - Added a short interval timer that checks the launched CLI process for exit and triggers cleanup and CSV export prompt automatically.

- run-gui.sh launcher script
  - Added `gui/run-gui.sh` to automate venv creation/activation and launching the GUI. The script:
    - Creates `.venv` (if missing),
    - Installs requirements,
    - Activates the venv and launches the GUI.
  - This makes launching the GUI easier for users who prefer a single command.

- Packaging guidance + one-file executable support
  - Provided instructions and working PyInstaller command to build a single-file GUI binary:
    - Include PySide6 Qt plugins (`platforms`, `imageformats`) via `--add-data`.
    - Example command (replace PLUGINDIR with your PySide6 plugins path discovered on your system):
      ```
      pyinstaller --noconfirm --onefile --windowed --name pulsebench-gui \
        --add-data "PLUGINDIR/platforms:PySide6/Qt/plugins/platforms" \
        --add-data "PLUGINDIR/imageformats:PySide6/Qt/plugins/imageformats" \
        gui/main.py
      ```
    - The typical plugins path on the venv used in testing was:
      ```
      /home/henri/Pulsebench/PulseBench/.venv/lib/python3.13/site-packages/PySide6/Qt/plugins
      ```
    - Resulting single-file GUI appears at: `dist/pulsebench-gui`

- Bug fixes and hardening
  - Fixed indentation and import problems in the initial `main.py` (added missing `QtGui` import and fixed several indentation issues).
  - Start/Stop buttons now use the Binary path from the UI, not a hard-coded constant.
  - Improved error dialogs for missing binary and start failures.
  - If a system does not provide temperature sensors, temperature plot will remain empty (0.0 used as fallback). Guidance added on installing `lm-sensors` where appropriate.

---

## How to run (GUI)

From the repository root:

```bash
cd /home/henri/Pulsebench/PulseBench
python -m venv .venv
source .venv/bin/activate
pip install -r gui/requirements.txt
python gui/main.py
```

Or use the launcher script:

```bash
cd /home/henri/Pulsebench/PulseBench
./gui/run-gui.sh
```

When the GUI is running, use the Binary field or Browse to select `build/pulsebench` and click Start.

---

## How to run (CLI)

Build the C++ CLI binary (if not already built):

```bash
mkdir -p build
cd build
cmake ..
make -j$(nproc)
```

Run the CLI directly:

```bash
./build/pulsebench --help
# or run a workload:
./build/pulsebench <workload-args>
```

---

## Packaging into a single GUI binary (PyInstaller)

From the project venv:

```bash
source .venv/bin/activate
PLUGINDIR=$(python -c 'import PySide6, os; print(os.path.join(os.path.dirname(PySide6.__file__), "Qt", "plugins"))')

pyinstaller --noconfirm --onefile --windowed --name pulsebench-gui \
  --add-data "$PLUGINDIR/platforms:PySide6/Qt/plugins/platforms" \
  --add-data "$PLUGINDIR/imageformats:PySide6/Qt/plugins/imageformats" \
  gui/main.py

# Resulting binary: ./dist/pulsebench-gui
```

If packaging fails with missing runtime files, try building in `--onedir` mode (remove `--onefile`) to inspect the bundled files.

---

## Files added / modified (high-level)

- `gui/main.py` — main GUI implementation (PySide6 UI, metrics worker, CSV logging, process watcher, Start/Stop, binary chooser).
- `gui/requirements.txt` — Python requirements for the GUI (PySide6, pyqtgraph, psutil, etc).
- `gui/README.md` — README with run instructions for the GUI.
- `gui/run-gui.sh` — launcher script to create/activate venv and run the GUI.
- `build/pulsebench` — CLI binary produced by the normal build flow (unchanged source code in `src/`).

---

## Known issues & environment notes

- Temperature sensors
  - Some Linux systems require `lm-sensors` and module probing to expose sensor data. If the temperature plot is empty or shows a constant low value:
    ```bash
    sudo apt install lm-sensors
    sudo sensors-detect
    sudo systemctl restart kmod   # or reboot, if required
    ```

- Packaging caveats
  - PyInstaller single-file executables unpack at runtime — first start may be slower. Some system libraries (e.g., libGL) are still required on the target machine.
  - Missing Qt `platforms` plugin causes “no Qt platform plugin could be initialized” errors. Ensure the plugin path is added via `--add-data` as shown above.
  - If you see runtime ImportError for modules that PyInstaller missed, add `--hidden-import modulename`.

---

## Developer notes & next steps (suggested)

- Add stdout/stderr capture threads to `gui/main.py` so process logs appear live in the Process Output pane.
- Add persistent settings (remember last binary path, last CSV folder) using a small config file (JSON).
- Add a `gui/build-gui.sh` script (automated PyInstaller build) and a `.spec` file tailored for PySide6 if you want reproducible builds. I can add and commit this if you want.
- Add a tiny automated smoke test that:
  - Starts the GUI,
  - Launches the CLI with `--help` or a short run,
  - Confirms the CSV prompt appears on exit.
- Optionally create a distribution package (deb/rpm) that installs both the CLI and the GUI executable to `/usr/local/bin`.

---

## LICENSE

```plaintext
MIT License

Copyright (c) 2025 Henri

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

```
